<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="assets/style.css"/>
    <script src="assets/mrpalette.js" type="text/javascript"></script>
    
    <title></title>
    
    <meta charset="utf-8">
    <script type="text/javascript">
    </script>
</head>
<body> 
    <div id="mainContainer">
        <h1>MrPalette</h1>
        <div id="dropContainer"> 
            <div id="picContainer"> </div>
        </div>
        
        <div id="instructionContainer">Drag and drop images in the box above to get the colour palette of the image.</div>
         
        <div id="controls"> 
            
            <button id="generateButton" type="button">Generate Palette</button>
        </div>
        
        <div id="colourOut"> </div>
        
        <div id="notes"><p>Author: Tim Kim/@timkim</p></div>
    </div>
    <script>
        // taken from and modified slightly: http://www.html5rocks.com/en/tutorials/file/dndfiles/#toc-selecting-files-dnd
        function handleFileSelect(evt) {
            evt.stopPropagation();
            evt.preventDefault();
        
            var files = evt.dataTransfer.files; // FileList object.
        
            // files is a FileList of File objects. List some properties.
            for (var i = 0, f; f = files[i]; i++) {
        
            // Only process image files.
            if (!f.type.match('image.*')) {
                continue;
            }
        
            var reader = new FileReader();
            // Closure to capture the file information.
            reader.onload = (function(theFile) {
                return function(e) {
                    var span = document.createElement('span');
                    span.innerHTML = ['<img class="uploadImage" src="', e.target.result,'"/>'].join('');
                    document.getElementById('picContainer').innerHTML = span.innerHTML;                   
                };
            })(f);
            
            // Read in the image file as a data URL.
            reader.readAsDataURL(f);            
            }
        }
        
        function handleDragOver(evt) {
            evt.stopPropagation();
            evt.preventDefault();
            evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
        }
        
        var dropContainer = document.getElementById('dropContainer');
        dropContainer.addEventListener('dragover', handleDragOver, false);
        dropContainer.addEventListener('drop', handleFileSelect, false); 
        
        var generateButton = document.getElementById('generateButton');
        generateButton.onclick = function(){
            var colourOut = document.getElementById('colourOut');
            if(colourOut.hasChildNodes()){
                while(colourOut.childNodes.length>0){
                    colourOut.removeChild(colourOut.firstChild);
                }
            }
            var myPalette = new MrPalette();
            var myPic = document.images[0];
            var options = {
                threshold: 50,
                maxNumColours: 8,
                container: 'colourOut'
            }
            myPalette.generateColourPalette(myPic, options);          
        }
        
    </script>
</body>
</html>
